<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Popacorn - Cart</title>
  <link rel="stylesheet" href="./style.css">
  <link rel="icon" href="./favicon.ico" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap"
    rel="stylesheet">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" />
  <script src="https://kit.fontawesome.com/3f34c302de.js" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>

<body>

  <main>


    <div class="navBar">
      <h1 style="margin:0;margin-left:15px;" id="mainNav">POPACORN</h1>


      <div id="mbar">
        <div class="mas">
          <i class="fa-solid fa-bag-shopping" style="margin:0;"></i>
          <div id="cartCount">
            <p id="cartCountP"></p>
          </div>
        </div>
        <i class="fa-solid fa-bars mab mbarc"></i>
        <i class="fa-solid fa-xmark max mbarc" id="x"></i>

      </div>

    </div>
    <div id="menu">
      <h4 class="menulink" id="mlStore" style="margin:0;margin-left:100px">Store</h4>
      <h4 class="menulink" id="mlDelivery" style="margin:0;margin-left:100px">Delivery</h4>
      <h4 class="menulink" id="mlContact" style="margin:0;margin-left:100px">Contact Us</h4>
    </div>
    <div id="cart">
      <h1>Your Shopping Cart</h1>
      <hr style="color:black;width:100%">
      <div id="cmain">
        <h4 id="empty">Your cart is empty</h4>
        <button class="secondaryBtn" id="storeL">Store</button>

        <div id="cartItems">
        </div>
        <div id="checkout">
          <div class="price">
            <div style="display:flex;align-items: center;flex-direction: column;margin-right:20px;">
              <p style="margin:0;font-weight:600;margin-right:10px;font-size:15px;line-height: 15px;">Subtotal: </p>

            </div>
            <p id="subtp" style="font-weight:300;font-size:15px;line-height:15px;margin-right:0;margin-left:auto;">
              $15.90</p>
          </div>
          <hr>
          <div class="price">
            <div style="display:flex;align-items: center;flex-direction: column;margin-right:20px;">
              <p style="margin:0;font-weight:600;margin-right:10px;font-size:15px;line-height: 15px;">Delivery Fee: </p>

            </div>
            <p id="subtd" style="font-weight:300;font-size:15px;line-height:15px;margin-right:0;margin-left:auto;">
              $15.90</p>
          </div>
          <hr>
          <div class="price">
            <div style="display:flex;align-items: center;flex-direction: column;margin-right:20px;">
              <p style="margin:0;font-weight:600;margin-right:10px;font-size:15px;line-height: 15px;">Total: </p>

            </div>
            <p id="finaltotal" style="font-weight:500;font-size:25px;line-height:15px;margin-right:0;margin-left:auto;">
              $15.90</p>
          </div>
          <button id="goCheckout" class="primaryBtn"
            style="width:100%;padding:5px 7px;font-size:17px;margin-top:10px;">Checkout</button>

        </div>
      </div>
    </div>
    <div id="checkoutmain">
      <h1>Checkout</h1>
      <hr style="color:black;width:100%">
      <div style="display: flex;flex-direction: row;">
        <div>
        <h3>First Name</h3>
        <input type="text" id="cfirst" placeholder="First Name" />
        </div>
        <div>
          <h3>Last Name</h3>
          <input type="text" id="clast" placeholder="Last Name" />
        </div>
      </div>

      <h3>Email</h3>
      <input type="text" id="cemail" placeholder="Email Address" />
      <h3>Phone Number</h3>
      <input type="text" id="cphone" placeholder="Phone Number" />
      <h3>Shipping Address</h3>
      <input type="text" id="caddress1" placeholder="Address Line 1" style="margin-bottom:0px;border-radius: 5px 5px 0px 0px;border-bottom-width: 0px;"/>
      <input type="text" id="caddress2" placeholder="Address Line 2 (optional)" style="border-radius: 0px;margin-bottom: 0px;border-bottom-width: 0px;"/>
      <input type="text" id="ccity" placeholder="City" style="border-radius: 0px;margin-bottom: 0px;border-bottom-width: 0px;" />
      <input type="text" id="ccountry" placeholder="Country" style="border-radius: 0px;margin-bottom: 0px;border-bottom-width: 0px;" />
      <input type="text" id="czip" placeholder="Postal Code" style="border-radius: 0px 0px 5px 5px;margin-bottom: 0px;" />
      <button class="primaryBtn">Complete Order</button>
    </div>
    <div class="main-content"
      style="height:10vh;width:100%;margin:0;background-color: #013a46;display:flex;justify-content: center;align-items: center;">
      <p style="color:white;font-weight: 300;">Popacorn 2024 - <span style="font-weight: 500;">Designed by <a
            href="https://revvifi.org" target="_blank"
            style="color:white !important;text-decoration: none;font-weight: 700;">Revvifi
            NY</a></span></p>
    </div>
  </main>
  <script src="index.js"></script>
  <script>
    const formatter = new Intl.NumberFormat('en-US', {
      style: 'decimal',
      maximumFractionDigits: 2,
      minimumFractionDigits: 2

    });
    function costFromWeight(weight) {
      if (weight <= 1) {
        return 50
      }
      return 70;

    }

    if (localStorage.getItem("cart") != null) {

      const PRODUCTS = {
        "garliccheese": {
          "img": "./assets/garliccheese.jpg",
          "title": "Garlic Cheese",
          "cost": 90.00,
        },
        "cheesecaramel": {
          "img": "./assets/cheesecaramel.jpg",
          "title": "Cheese Caramel",
          "cost": 100.00,
        },
        "caramelchocolate": {
          "img": "./assets/chocolatecaramel.jpg",
          "cost": 100.00,
          "title": "Chocolate Caramel",
        },
        "classiccaramel": {
          "img": "./assets/classiccaramel.jpg",
          "cost": 90.00,
          "title": "Classic Salted Caramel",
        },
        "cookiesandcream": {
          "img": "./assets/cookiesandcream.jpg",
          "cost": 100.00,
          "title": "Cookies and Cream",
        }
      }
      let cart = JSON.parse(localStorage.getItem('cart'));
      let finalcost = 0;
      let countsm = 0;
      let countlg = 0;
      if (cart.length == 0) {
        $("#checkout").css("display", "none");
      } else {
        $("#empty").css("display", "none");
        $("#storeL").css('display', "none");
      }

      for (let item of cart) {

        const productData = PRODUCTS[item.id];
        console.log(productData.img);
        let primaryCost = productData.cost;
        if (item.portion == "small") {
          primaryCost -= 37;
          countsm += 1;
        } else {
          countlg += 1;
        }
        const addons = item.addons;
        let addonscount = 0;
        let addonstext = "Addons: ";
        for (let addondat of Object.keys(addons)) {
          const addon = addons[addondat];
          if (addon.val == false) {
            continue;
          }
          if (addonscount != 0) {
            addonstext += ", ";
          }
          addonstext += addon.name;
          addonscount += 1;
        }
        let secondaryCosts = addonscount * 20.00;
        const final = primaryCost + secondaryCosts;
        if (addonscount == 0) {
          addonstext = "No Addons";
        }
        const uid = item.uid;
        finalcost += final;

        $("#cartItems").append(`
          <div class="cartItem" id="c${uid}">
            <div class="delete" id="${uid}">
              <i class="fa-solid fa-xmark"></i>
            </div>
            <img src="${productData.img}"/>
            <div class="itemInfo">
              <h3>${item.portion} ${productData.title}</h3>
              <p>${addonstext}</p>

            </div>
            <div class="costInfo">
              <p class="primaryCost">৳${formatter.format(primaryCost)}</p>
              <p class="secondaryCost">৳${formatter.format(secondaryCosts)}</p>
              <p class="finalCost">৳${formatter.format(final)}</p>
            </div>
          </div>
          `
        )
        $("#" + uid).click(function () {
          $("#c" + uid).css("display", "none");
          const result = (cart.filter((cartite) => String(cartite.uid) != String(uid)));
          localStorage.setItem("cart", JSON.stringify(result));
          cart = result;
          finalcost = 0;
          let numsl = 0;
          let numlg = 0;
          for (let item of cart) {
            finalcost += PRODUCTS[item.id].cost;
            for (let addon of Object.values(item.addons)) {
              if (addon.val) {
                finalcost += 20;
              }
            }
            if (item.portion == "small") {
              numsl += 1;
            } else {
              numlg += 1;
            }
          }
          $("#subtp").html("৳" + formatter.format(finalcost));

          if (finalcost > 1099) {

            $("#subtd").html("৳0.00");
          } else {
            let weight = (0.2 * numlg) + (0.05 * numsl);
            $("#subtd").html("৳" + formatter.format(weight));

            finalcost += costFromWeight(weight);

          }

          if (cart.length == 0) {
            $("#checkout").css("display", "none");
            $("#empty").css('display', "block");
            $("#storeL").css('display', "block");
          }

          $("#finaltotal").html("৳" + formatter.format(finalcost));

          if (localStorage.getItem("cart") !== null) {
            const dat = JSON.parse(localStorage.getItem("cart"));
            console.log(dat);
            $("#cartCountP").html(dat.length);
            $("#cartCount").css('display', 'flex');

          } else {
            $("#cartCount").css('display', 'none');

          }
        })
      }
      $("#subtp").html("৳" + formatter.format(finalcost));
      console.log($("#cartCountP").html())
      console.log(countlg)
      console.log(countsm)

      if (finalcost > 1099) {
        $("#subtd").html("৳0.00");
      } else {
        let weight = (0.2 * countlg) + (0.05 * countsm);
        console.log(weight);
        finalcost += costFromWeight(weight);
        $("#subtd").html("৳" + formatter.format(costFromWeight(weight)));

      }
      $("#finaltotal").html("৳" + formatter.format(finalcost));


    }
    $("#checkoutmain").css('display', 'none');

    $("#goCheckout").click(function () {
      $("#cart").css('display', 'none');
      $("#checkoutmain").css('display', 'flex');
    })



  </script>


</body>

</html>
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Popacorn - Admin Consoole</title>
  <link rel="stylesheet" href="./style.css">
  <link rel="icon" href="./favicon.ico" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap"
    rel="stylesheet">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" />
  <script src="https://kit.fontawesome.com/3f34c302de.js" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>

<body>

  <main>


    <div class="navBar">
      <h1 style="margin:0;margin-left:15px;" id="mainNav">POPACORN</h1>


      <div id="mbar">
        <div class="mas">
          <i class="fa-solid fa-bag-shopping" style="margin:0;"></i>
          <div id="cartCount">
            <p id="cartCountP"></p>
          </div>
        </div>
        <i class="fa-solid fa-bars mab mbarc"></i>
        <i class="fa-solid fa-xmark max mbarc" id="x"></i>

      </div>

    </div>
    <div id="menu">
      <h4 class="menulink" id="mlStore" style="margin:0;margin-left:100px">Store</h4>
      <h4 class="menulink" id="mlDelivery" style="margin:0;margin-left:100px">Delivery</h4>
      <h4 class="menulink" id="mlContact" style="margin:0;margin-left:100px">Contact Us</h4>
    </div>
    <div id="contentadmin">
      <div id="admin">
        <h1>Admin Console</h1>
        <h2>Orders View</h2>
        <table id="btable" style="width:100%;">
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Address</th>
            <th>Phone Number</th>
            <th>Time Created</th>
            <th>Cart</th>
          </tr>





        </table>
        <h2>Delete Order by ID</h2>
        <div style="width:300px">
          <input id="deleteId" type="text" placeholder="Order ID">
          <button id="deleteOrder">Delete</button>
        </div>

      </div>
    </div>
    <div class="main-content"
      style="height:10vh;width:100%;margin:0;background-color: #013a46;display:flex;justify-content: center;align-items: center;">
      <p style="color:white;font-weight: 300;">Popacorn 2024 - <span style="font-weight: 500;">Designed by <a
            href="https://revvifi.org" target="_blank"
            style="color:white !important;text-decoration: none;font-weight: 700;">Revvifi
            NY</a></span></p>
    </div>

  </main>

  <script src="index.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
    import { getFirestore, deleteDoc, doc, setDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    const firebaseConfig = {
      apiKey: "AIzaSyBLZQeeK9JAESw3gN7l0hksGbyUMlbm3ZQ",
      authDomain: "popacorn-8af6b.firebaseapp.com",
      projectId: "popacorn-8af6b",
      storageBucket: "popacorn-8af6b.appspot.com",
      messagingSenderId: "61775911379",
      appId: "1:61775911379:web:464bacfa574458965b3726",
      measurementId: "G-WHDEL9KXW3"
    };
    var token = function () {
      return Math.random().toString(36).substr(2);
    };
    function toTitleCase(str) {
      return str.replace(
        /\w\S*/g,
        function (txt) {
          return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
        }
      );
    }
    //https://stackoverflow.com/questions/196972/convert-string-to-title-case-with-javascript
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);
    const PRODUCTS = {
      "garliccheese": {
        "img": "./assets/garliccheese.jpg",
        "title": "Garlic Cheese",
        "cost": 90.00,
      },
      "cheesecaramel": {
        "img": "./assets/cheesecaramel.jpg",
        "title": "Cheese Caramel",
        "cost": 100.00,
      },
      "caramelchocolate": {
        "img": "./assets/chocolatecaramel.jpg",
        "cost": 100.00,
        "title": "Chocolate Caramel",
      },
      "classiccaramel": {
        "img": "./assets/classiccaramel.jpg",
        "cost": 90.00,
        "title": "Classic Salted Caramel",
      },
      "cookiesandcream": {
        "img": "./assets/cookiesandcream.jpg",
        "cost": 100.00,
        "title": "Cookies and Cream",
      }
    }
    window.onload = async function () {
      const querySnapshot = await getDocs(collection(db, "orders"));
        function updateCartCount() {
        if (localStorage.getItem("cart") !== null) {
          const dat = JSON.parse(localStorage.getItem("cart"));
          console.log(dat);
          $("#cartCountP").html(dat.length);
          $("#cartCount").css('display', 'flex');

        } else {
          $("#cartCount").css('display', 'none');

        }
      }
      updateCartCount();
      querySnapshot.forEach((doc) => {
        const id = doc.id;
        const data = doc.data();
        const cart = JSON.parse(data.cartraw);
        $("#btable").append(`
        <tr>
          <td>${id}</td>
          <td>${data.name}</td>
          <td>${data.email}</td>
          <td>${data.address}</td>
          <td>${data.phonenumber}</td>
          <td>${new Date(data.timecreated)}</td>
          <td id="cart${id}"></td>
        </tr>
        `)
        for (let item of cart) {
          console.log(item);
          let cost = PRODUCTS[item.id].cost;
          if (item.portion == "small") {
            cost -= 37;
          }
          let cText = '<span style="font-weight:600">' + toTitleCase(item.portion) + " " + PRODUCTS[item.id].title + "</span><span style='font-size:15px;'> with "
          let addcount = 0;
          for (let addon of Object.values(item.addons)) {
            if (addon.val == false) {
              continue
            }
            if (addcount != 0) {
              cText += ", ";
            }
            cText += addon.name;
            cost += 20;
            addcount++;
          }
          cText += "</span><span style='font-weight:800'> (৳" + cost + ")</span>"
          $("#cart" + id).append(`
            <p style="margin:0;margin-bottom:5px;">${cText}</p>
            <hr>
          `)
        }
        $("#cart" + id).append(`
            <p style="margin:0;margin-bottom:5px;font-weight:800">Total Cost (With delivery fee): ৳${data.total}</p>
          `)
      });
      $("#deleteOrder").click(async function () {
        deleteDoc(doc(db, "orders", $("#deleteId").val())).then(function () {
          window.location.reload();

        })
      })
    }


  </script>

</body>

</html>
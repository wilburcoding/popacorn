<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Popacorn - Admin Consoole</title>
  <link rel="stylesheet" href="./style.css">
  <link rel="icon" href="./favicon.ico" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap"
    rel="stylesheet">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" />
  <script src="https://kit.fontawesome.com/3f34c302de.js" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>

<body>

  <main>


    <div class="navBar">
      <h1 style="margin:0;margin-left:15px;" id="mainNav">POPACORN</h1>


      <div id="mbar">
        <div class="mas">
          <i class="fa-solid fa-bag-shopping" style="margin:0;"></i>
          <div id="cartCount">
            <p id="cartCountP"></p>
          </div>
        </div>
        <i class="fa-solid fa-bars mab mbarc"></i>
        <i class="fa-solid fa-xmark max mbarc" id="x"></i>

      </div>

    </div>
    <div id="menu">
      <h4 class="menulink" id="mlStore" style="margin:0;margin-left:100px">Store</h4>
      <h4 class="menulink" id="mlDelivery" style="margin:0;margin-left:100px">Delivery</h4>
      <h4 class="menulink" id="mlContact" style="margin:0;margin-left:100px">Contact Us</h4>
    </div>
    <div id="contentadmin">
      <div id="admin">
        <h1>Admin Console</h1>
        <table id="btable" style="width:100%;">
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Phone Number</th>
            <th>Time Created</th>
            <th>Cart</th>
          </tr>




        </table>
      </div>
    </div>

  </main>
  <script src="index.js"></script>
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
    import { getFirestore, doc, setDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    const firebaseConfig = {
      apiKey: "AIzaSyBLZQeeK9JAESw3gN7l0hksGbyUMlbm3ZQ",
      authDomain: "popacorn-8af6b.firebaseapp.com",
      projectId: "popacorn-8af6b",
      storageBucket: "popacorn-8af6b.appspot.com",
      messagingSenderId: "61775911379",
      appId: "1:61775911379:web:464bacfa574458965b3726",
      measurementId: "G-WHDEL9KXW3"
    };
    var token = function () {
      return Math.random().toString(36).substr(2); // remove `0.`
    };
    function toTitleCase(str) {
        return str.replace(
          /\w\S*/g,
          function (txt) {
            return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
          }
        );
      }
      //https://stackoverflow.com/questions/196972/convert-string-to-title-case-with-javascript
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);
    window.onload = async function () {
      const querySnapshot = await getDocs(collection(db, "orders"));
      querySnapshot.forEach((doc) => {
        const id = doc.id;
        const data = doc.data();
        const cart = JSON.parse(data.cartraw);
        $("#btable").append(`
        <tr>
          <td>${id}</td>
          <td>${data.name}</td>
          <td>${data.email}</td>
          <td>${data.phonenumber}</td>
          <td>${new Date(data.timecreated)}</td>
          <td id="cart${id}"></td>
        </tr>
        `)
        for (let item of cart) {
          console.log(item);
          let cText = 
          $("#cart" + id).append(`

          `)
        }
      });
    }


  </script>

</body>

</html>